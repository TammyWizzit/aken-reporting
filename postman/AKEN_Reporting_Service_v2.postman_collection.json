{
	"info": {
		"_postman_id": "aken-reporting-v2-collection",
		"name": "AKEN Reporting Service v2.0",
		"description": "Complete API collection for AKEN Reporting Service v2.0 - Modern RESTful transaction reporting API built with Go.\n\n## Features\n- Advanced filtering with operators\n- Field selection to reduce payload\n- Flexible sorting and pagination  \n- Merchant analytics and summaries\n- JWT token-based authentication\n\n## Authentication\nUses JWT (Bearer Token) authentication:\n1. Generate token: POST /api/v2/auth/generate-token with merchant credentials\n2. Use token: Add Authorization: Bearer <token> header to all protected requests\n3. Token expires in 24 hours\n\n## Base URLs\n- Development: http://localhost:8090\n- Staging: https://aken-reporting-staging.example.com\n- Production: https://aken-reporting.example.com",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "aken-reporting-service"
	},
	"item": [
		{
			"name": "üîê Authentication",
			"item": [
				{
					"name": "Generate JWT Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"// Test that the request was successful",
									"pm.test('Token generation successful', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"// Parse the response and store the token",
									"if (pm.response.code === 200) {",
									"    const responseJson = pm.response.json();",
									"    ",
									"    // Store token in global environment variables",
									"    pm.globals.set('jwt_token', responseJson.token);",
									"    pm.globals.set('token_type', responseJson.token_type);",
									"    pm.globals.set('token_expires_in', responseJson.expires_in);",
									"    ",
									"    // Calculate and store expiration time",
									"    const expirationTime = new Date(Date.now() + (responseJson.expires_in * 1000));",
									"    pm.globals.set('token_expires_at', expirationTime.toISOString());",
									"    ",
									"    console.log('‚úÖ JWT token stored in global environment');",
									"    console.log('Token expires at:', expirationTime.toLocaleString());",
									"} else {",
									"    console.log('‚ùå Failed to get token:', pm.response.text());",
									"}"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\\n    \\\"merchant_id\\\": \\\"{{merchant_id}}\\\",\\n    \\\"password\\\": \\\"{{merchant_password}}\\\"\\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v2/auth/generate-token",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"auth",
								"generate-token"
							]
						},
						"description": "Generate a JWT token for authentication. This token will be automatically stored and used for subsequent requests."
					},
					"response": [
						{
							"name": "Successful Token Generation",
							"originalRequest": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\\n    \\\"merchant_id\\\": \\\"9cda37a0-4813-11ef-95d7-c5ac867bb9fc\\\",\\n    \\\"password\\\": \\\"password123\\\"\\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/v2/auth/generate-token",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"v2",
										"auth",
										"generate-token"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\\n    \\\"token\\\": \\\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\\\",\\n    \\\"expires_in\\\": 86400,\\n    \\\"token_type\\\": \\\"Bearer\\\"\\n}"
						}
					]
				},
				{
					"name": "Verify JWT Token",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v2/auth/verify-token",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"auth",
								"verify-token"
							]
						},
						"description": "Verify that the current JWT token is valid and get token information."
					}
				}
			],
			"description": "Authentication endpoints for JWT token generation and verification."
		},
		{
			"name": "üè• System Health",
			"item": [
				{
					"name": "Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v2/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2", 
								"health"
							]
						},
						"description": "Check if the AKEN Reporting Service is healthy and responsive."
					},
					"response": [
						{
							"name": "Healthy Response",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}/api/v2/health",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"v2",
										"health"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n    \"status\": \"healthy\",\n    \"service\": \"AKEN Reporting Service\",\n    \"version\": \"2.0.0\",\n    \"timestamp\": \"2025-01-28T10:30:00.000Z\",\n    \"uptime\": 86400\n}"
						}
					]
				},
				{
					"name": "API Info",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v2/info",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"info"
							]
						},
						"description": "Get detailed information about the API endpoints and features."
					}
				},
				{
					"name": "Debug Info (Dev Only)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/debug",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"debug"
							]
						},
						"description": "Debug endpoint showing environment and authentication status (development only)."
					}
				}
			],
			"description": "System health and information endpoints."
		},
		{
			"name": "üìä Transactions",
			"item": [
				{
					"name": "List All Transactions",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v2/transactions",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"transactions"
							]
						},
						"description": "Get all transactions with default settings (100 records, all fields, newest first)."
					}
				},
				{
					"name": "Transactions with Field Selection",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v2/transactions?fields=payment_tx_log_id,amount,merchant_name,tx_date_time,response_code",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"transactions"
							],
							"query": [
								{
									"key": "fields",
									"value": "tx_log_id,amount,merchant_name,tx_date_time,response_code",
									"description": "Only return specific fields"
								}
							]
						},
						"description": "Get transactions with only specific fields to reduce payload size."
					}
				},
				{
					"name": "Filtered Transactions - Success Only",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v2/transactions?filter=response_code:eq:00&sort=amount:desc&limit=20",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"transactions"
							],
							"query": [
								{
									"key": "filter",
									"value": "response_code:eq:00",
									"description": "Only successful transactions"
								},
								{
									"key": "sort",
									"value": "amount:desc",
									"description": "Sort by amount descending"
								},
								{
									"key": "limit",
									"value": "20",
									"description": "Limit to 20 records"
								}
							]
						},
						"description": "Get only successful transactions, sorted by amount (highest first)."
					}
				},
				{
					"name": "Date Range Filter",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v2/transactions?filter=tx_date_time:between:2024-01-01,2024-12-31&timezone=Africa/Johannesburg",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"transactions"
							],
							"query": [
								{
									"key": "filter",
									"value": "tx_date_time:between:2024-01-01,2024-12-31",
									"description": "Transactions from 2024"
								},
								{
									"key": "timezone",
									"value": "Africa/Johannesburg",
									"description": "South African timezone"
								}
							]
						},
						"description": "Get transactions from 2024 with South African timezone formatting."
					}
				},
				{
					"name": "Complex Filter - Amount & Status",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v2/transactions?filter=(response_code:eq:00 OR response_code:eq:10) AND amount:gte:1000&sort=tx_date_time:desc",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"transactions"
							],
							"query": [
								{
									"key": "filter",
									"value": "(response_code:eq:00 OR response_code:eq:10) AND amount:gte:1000",
									"description": "Successful transactions above R10.00"
								},
								{
									"key": "sort",
									"value": "tx_date_time:desc",
									"description": "Newest first"
								}
							]
						},
						"description": "Get successful transactions (00 or 10 response) with amount >= R10.00."
					}
				},
				{
					"name": "Paginated Results - Page 2",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v2/transactions?page=2&limit=50",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"transactions"
							],
							"query": [
								{
									"key": "page",
									"value": "2",
									"description": "Page 2 (1-based)"
								},
								{
									"key": "limit",
									"value": "50",
									"description": "50 records per page"
								}
							]
						},
						"description": "Get page 2 of results with 50 records per page."
					}
				},
				{
					"name": "Get Single Transaction",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v2/transactions/{{transaction_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"transactions",
								"{{transaction_id}}"
							]
						},
						"description": "Get details of a specific transaction by ID."
					}
				},
				{
					"name": "Advanced Search Query",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\"range\": {\"amount\": {\"gte\": 1000, \"lte\": 5000}}},\n        {\"term\": {\"merchant_id\": \"{{merchant_id}}\"}},\n        {\"range\": {\"tx_date_time\": {\"gte\": \"2024-01-01\", \"lte\": \"2024-12-31\"}}}\n      ],\n      \"should\": [\n        {\"term\": {\"response_code\": \"00\"}},\n        {\"term\": {\"response_code\": \"10\"}}\n      ]\n    }\n  },\n  \"fields\": [\"tx_log_id\", \"amount\", \"merchant_name\", \"tx_date_time\", \"response_code\"],\n  \"sort\": [\n    {\"tx_date_time\": {\"order\": \"desc\"}},\n    {\"amount\": {\"order\": \"asc\"}}\n  ],\n  \"pagination\": {\n    \"page\": 1,\n    \"limit\": 100\n  },\n  \"aggregations\": {\n    \"total_amount\": {\"sum\": {\"field\": \"amount\"}},\n    \"avg_amount\": {\"avg\": {\"field\": \"amount\"}}\n  }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v2/transactions/search",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"transactions",
								"search"
							]
						},
						"description": "Advanced search with Elasticsearch-style query DSL and aggregations."
					}
				},
				{
					"name": "Transaction Totals by Date",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v2/transactions/totals?date=2024-01-15",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"transactions",
								"totals"
							],
							"query": [
								{
									"key": "date",
									"value": "2024-01-15",
									"description": "Date in YYYY-MM-DD format (required)"
								}
							]
						},
						"description": "Get transaction totals aggregated by transaction type for a specific date. Shows totals for payment, void, refund, etc. Now uses GET with query parameters."
					}
				},
				{
					"name": "Transaction Totals with Device Filter",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v2/transactions/totals?date=2024-01-15&device_id=DEV001&terminal_id=TERM001",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"transactions",
								"totals"
							],
							"query": [
								{
									"key": "date",
									"value": "2024-01-15",
									"description": "Date in YYYY-MM-DD format (required)"
								},
								{
									"key": "device_id",
									"value": "DEV001",
									"description": "Optional device ID filter"
								},
								{
									"key": "terminal_id",
									"value": "TERM001",
									"description": "Optional terminal ID filter"
								}
							]
						},
						"description": "Get transaction totals filtered by specific device and terminal for a given date. Now uses GET with query parameters including device_id and terminal_id filters."
					}
				}
			],
			"description": "Core transaction endpoints with various filtering, sorting, and pagination examples."
		},
		{
			"name": "üè¢ Merchants",
			"item": [
				{
					"name": "Merchant Summary",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v2/merchants/{{merchant_id}}/summary",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"merchants",
								"{{merchant_id}}",
								"summary"
							]
						},
						"description": "Get comprehensive summary statistics for the merchant including transaction counts, amounts, and success rates."
					}
				},
				{
					"name": "Merchant Summary with Date Filter",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v2/merchants/{{merchant_id}}/summary?filter=tx_date_time:between:2024-01-01,2024-12-31",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"merchants",
								"{{merchant_id}}",
								"summary"
							],
							"query": [
								{
									"key": "filter",
									"value": "tx_date_time:between:2024-01-01,2024-12-31",
									"description": "Summary for 2024 only"
								}
							]
						},
						"description": "Get merchant summary for a specific date range (2024 in this example)."
					}
				},
				{
					"name": "Merchant Transactions",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v2/merchants/{{merchant_id}}/transactions",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"merchants",
								"{{merchant_id}}",
								"transactions"
							]
						},
						"description": "Get all transactions for a specific merchant (redirects to main transactions endpoint with merchant filter)."
					}
				}
			],
			"description": "Merchant-specific endpoints for summaries and transaction filtering."
		},
		{
			"name": "üöß Future Features",
			"item": [
				{
					"name": "Export Transactions (Not Implemented)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"format\": \"csv\",\n  \"filters\": {\n    \"tx_date_time\": {\"gte\": \"2024-01-01\", \"lte\": \"2024-12-31\"}\n  },\n  \"fields\": [\"tx_log_id\", \"amount\", \"merchant_name\", \"tx_date_time\"],\n  \"delivery\": {\n    \"method\": \"download\"\n  }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v2/transactions/export",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"transactions",
								"export"
							]
						},
						"description": "Initiate bulk export of transaction data. Returns 501 Not Implemented - future feature."
					}
				},
				{
					"name": "Batch Operations (Not Implemented)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"requests\": [\n    {\n      \"id\": \"req1\",\n      \"method\": \"GET\",\n      \"endpoint\": \"/transactions\",\n      \"parameters\": {\"limit\": 10}\n    },\n    {\n      \"id\": \"req2\",\n      \"method\": \"GET\", \n      \"endpoint\": \"/merchants/{{merchant_id}}/summary\"\n    }\n  ]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v2/transactions/batch",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"transactions",
								"batch"
							]
						},
						"description": "Process multiple requests in a single call. Returns 501 Not Implemented - future feature."
					}
				},
				{
					"name": "Analytics Summary (Not Implemented)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v2/analytics/summary",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v2",
								"analytics",
								"summary"
							]
						},
						"description": "Get overall analytics summary. Returns 501 Not Implemented - future feature."
					}
				}
			],
			"description": "Future features that return 501 Not Implemented responses. These are planned for future releases."
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Set request timestamp",
					"pm.globals.set('timestamp', new Date().toISOString());",
					"",
					"// Generate request ID for tracking",
					"pm.globals.set('request_id', 'req_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9));",
					"",
					"// Collection-level JWT token handler",
					"const token = pm.globals.get('jwt_token');",
					"const expiresAt = pm.globals.get('token_expires_at');",
					"",
					"// Skip token logic for the auth endpoint itself",
					"if (pm.request.url.toString().includes('/auth/generate-token')) {",
					"    console.log('üîì Skipping auth for token generation endpoint');",
					"    return;",
					"}",
					"",
					"// Skip token logic for unprotected endpoints",
					"if (pm.request.url.toString().includes('/health') || ",
					"    pm.request.url.toString().includes('/info') || ",
					"    pm.request.url.toString().includes('/debug')) {",
					"    console.log('üîì Skipping auth for unprotected endpoint');",
					"    return;",
					"}",
					"",
					"if (!token) {",
					"    console.log('‚ùå No JWT token found. Please run \\'Generate JWT Token\\' request first.');",
					"    return;",
					"}",
					"",
					"// Check if token is expired",
					"if (expiresAt && new Date() >= new Date(expiresAt)) {",
					"    console.log('‚ö†Ô∏è JWT token has expired (' + expiresAt + ')');",
					"    console.log('Please run \\'Generate JWT Token\\' request again.');",
					"    return;",
					"}",
					"",
					"// Automatically add Authorization header to all requests",
					"pm.request.headers.add({",
					"    key: 'Authorization',",
					"    value: 'Bearer ' + token",
					"});",
					"",
					"console.log('‚úÖ JWT token automatically added to request');"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Global tests for all requests",
					"",
					"// Check that we get a response",
					"pm.test('Response received', function () {",
					"    pm.response.to.not.be.undefined;",
					"});",
					"",
					"// Check response time",
					"pm.test('Response time is reasonable', function () {",
					"    pm.expect(pm.response.responseTime).to.be.below(5000);",
					"});",
					"",
					"// Check for security headers",
					"if (pm.response.code === 200) {",
					"    pm.test('Has API version header', function () {",
					"        pm.expect(pm.response.headers.get('X-API-Version')).to.include('2.');",
					"    });",
					"    ",
					"    pm.test('Has service name header', function () {",
					"        pm.expect(pm.response.headers.get('X-Service-Name')).to.include('AKEN');",
					"    });",
					"}",
					"",
					"// Check error responses have proper structure",
					"if (pm.response.code >= 400) {",
					"    pm.test('Error response has proper structure', function () {",
					"        const response = pm.response.json();",
					"        pm.expect(response).to.have.property('error');",
					"        pm.expect(response.error).to.have.property('code');",
					"        pm.expect(response.error).to.have.property('message');",
					"        pm.expect(response.error).to.have.property('timestamp');",
					"    });",
					"}",
					"",
					"// For successful data responses, check structure",
					"if (pm.response.code === 200 && pm.response.json().data) {",
					"    pm.test('Success response has proper structure', function () {",
					"        const response = pm.response.json();",
					"        pm.expect(response).to.have.property('data');",
					"        pm.expect(response).to.have.property('meta');",
					"        pm.expect(response.meta).to.have.property('timestamp');",
					"        pm.expect(response.meta).to.have.property('version');",
					"    });",
					"}"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8090",
			"description": "Base URL for the AKEN Reporting Service"
		},
		{
			"key": "merchant_id",
			"value": "9cda37a0-4813-11ef-95d7-c5ac867bb9fc",
			"description": "Merchant ID for authentication (UUID format)"
		},
		{
			"key": "merchant_password",
			"value": "password123",
			"description": "Merchant password for JWT token generation"
		},
		{
			"key": "transaction_id",
			"value": "f3b24260-903f-11ef-b4a1-4982815eb203",
			"description": "Sample transaction ID for single transaction requests"
		}
	]
}